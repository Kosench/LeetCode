### 177. N-я по величине зарплата
Решено  
Средняя сложность

#### Задача:
Дана таблица `Employee`. Необходимо написать запрос, который найдет **n-ю по величине уникальную зарплату** из таблицы `Employee`. Если уникальных зарплат меньше, чем `n`, вернуть `null`.

---

#### Структура таблицы:

**Таблица Employee:**

| Column Name | Type |
|-------------|------|
| id          | int  |
| salary      | int  |

- `id` — первичный ключ (уникальное значение) для этой таблицы.
- Каждая строка таблицы содержит информацию о зарплате сотрудника.

---

#### Примеры:

**Пример 1:**

**Ввод:**

Таблица `Employee`:

| id | salary |
|----|--------|
| 1  | 100    |
| 2  | 200    |
| 3  | 300    |

`n = 2`

**Вывод:**

| getNthHighestSalary(2) |
|------------------------|
| 200                    |

**Объяснение:**  
Вторая по величине уникальная зарплата — это `200`.

---

**Пример 2:**

**Ввод:**

Таблица `Employee`:

| id | salary |
|----|--------|
| 1  | 100    |

`n = 2`

**Вывод:**

| getNthHighestSalary(2) |
|------------------------|
| null                   |

**Объяснение:**  
В таблице только одна уникальная зарплата, поэтому второй по величине зарплаты нет, и результат — `null`.

---

#### Решение (SQL):

Для решения задачи можно использовать подзапрос с функцией `DISTINCT`, чтобы найти уникальные зарплаты, отсортировать их по убыванию и выбрать n-ю зарплату. Если таких зарплат меньше, чем `n`, то возвращается `NULL`.

```sql
CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT
BEGIN
  RETURN (
    SELECT DISTINCT salary
    FROM Employee
    ORDER BY salary DESC
    LIMIT 1 OFFSET N - 1
  );
END;
```

---

#### Пояснение к запросу:
1. **Подзапрос**:
    - `SELECT DISTINCT salary`: Выбираем уникальные значения зарплат.
    - `ORDER BY salary DESC`: Сортируем зарплаты по убыванию.
    - `LIMIT 1 OFFSET N - 1`: Пропускаем первые `(N - 1)` зарплат и выбираем следующую за ними.
2. **Функция**:
    - Функция `getNthHighestSalary(N)` принимает параметр `N` и возвращает n-ю по величине зарплату.
    - Если подзапрос не возвращает значений (например, если в таблице меньше `N` уникальных зарплат), результат будет `NULL`.

---

#### Результат:
Запрос вернет таблицу с одной колонкой `getNthHighestSalary(N)`, содержащей n-ю по величине уникальную зарплату. Если такой зарплаты нет, результат будет `null`.

---

#### Примечание:
Если вы используете MySQL, то конструкция `LIMIT` с `OFFSET` требует, чтобы `OFFSET` был константой. Поэтому в некоторых случаях может потребоваться предварительное вычисление `N - 1` перед выполнением запроса. Например:

```sql
CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT
BEGIN
  DECLARE M INT;
  SET M = N - 1;
  RETURN (
    SELECT DISTINCT salary
    FROM Employee
    ORDER BY salary DESC
    LIMIT 1 OFFSET M
  );
END;
```

Это решение работает корректно для всех случаев.