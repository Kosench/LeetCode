262. Поездки и пользователи
Уровень: Сложный
Темы:
Иконка премиум-доступа Компании
Схема SQL
Схема Pandas

Таблица: Trips (Поездки)

+-------------+----------+
| Имя столбца | Тип      |
+-------------+----------+
| id          | int      |
| client_id   | int      |
| driver_id   | int      |
| city_id     | int      |
| status      | enum     |
| request_at  | varchar  |
+-------------+----------+
id — первичный ключ (уникальное значение) для этой таблицы.
Таблица содержит данные о всех поездках на такси. Каждая поездка имеет уникальный id, а client_id и driver_id являются внешними ключами, ссылающимися на users_id из таблицы Users.
Статус — это ENUM (перечисление) со значениями: ('completed', 'cancelled_by_driver', 'cancelled_by_client').

Таблица: Users (Пользователи)

+-------------+----------+
| Имя столбца | Тип      |
+-------------+----------+
| users_id    | int      |
| banned      | enum     |
| role        | enum     |
+-------------+----------+
users_id — первичный ключ (уникальное значение) для этой таблицы.
Таблица содержит информацию о всех пользователях. Каждый пользователь имеет уникальный users_id, поле role — это ENUM со значениями ('client', 'driver', 'partner'), а banned — ENUM со значениями ('Yes', 'No').

Показатель отмен (коэффициент отмены) рассчитывается как отношение количества отменённых запросов (отменённых клиентом или водителем), в которых ни клиент, ни водитель не были заблокированы (не banned), к общему количеству запросов с незаблокированными пользователями в этот день.

Напишите решение, чтобы найти коэффициент отмены поездок с незаблокированными пользователями (и клиент, и водитель не должны быть заблокированы) по каждому дню в период с «2013-10-01» по «2013-10-03» включительно, в которых была хотя бы одна поездка. Округлите значение коэффициента отмены до двух знаков после запятой.

Верните результат в любом порядке.

Формат результата приведён в примере ниже.

Пример 1:

Ввод:
Таблица Trips:

+----+-----------+-----------+---------+---------------------+------------+
| id | client_id | driver_id | city_id | status              | request_at |
+----+-----------+-----------+---------+---------------------+------------+
| 1  | 1         | 10        | 1       | completed           | 2013-10-01 |
| 2  | 2         | 11        | 1       | cancelled_by_driver | 2013-10-01 |
| 3  | 3         | 12        | 6       | completed           | 2013-10-01 |
| 4  | 4         | 13        | 6       | cancelled_by_client | 2013-10-01 |
| 5  | 1         | 10        | 1       | completed           | 2013-10-02 |
| 6  | 2         | 11        | 6       | completed           | 2013-10-02 |
| 7  | 3         | 12        | 6       | completed           | 2013-10-02 |
| 8  | 2         | 12        | 12      | completed           | 2013-10-03 |
| 9  | 3         | 10        | 12      | completed           | 2013-10-03 |
| 10 | 4         | 13        | 12      | cancelled_by_driver | 2013-10-03 |
+----+-----------+-----------+---------+---------------------+------------+

Таблица Users:

+----------+--------+--------+
| users_id | banned | role   |
+----------+--------+--------+
| 1        | No     | client |
| 2        | Yes    | client |
| 3        | No     | client |
| 4        | No     | client |
| 10       | No     | driver |
| 11       | No     | driver |
| 12       | No     | driver |
| 13       | No     | driver |
+----------+--------+--------+

Вывод:

+------------+-------------------+
| Day        | Cancellation Rate |
+------------+-------------------+
| 2013-10-01 | 0.33              |
| 2013-10-02 | 0.00              |
| 2013-10-03 | 0.50              |
+------------+-------------------+

Пояснение:
- 2013-10-01:
  - Всего 4 запроса, из них 2 были отменены.
  - Однако запрос с Id=2 был сделан заблокированным клиентом (User_Id=2), поэтому он исключается из расчёта.
  - Таким образом, всего 3 незаблокированных запроса, из них 1 отменён.
  - Коэффициент отмены = (1 / 3) = 0.33

- 2013-10-02:
  - Всего 3 запроса, отмен не было.
  - Запрос с Id=6 исключается, так как клиент заблокирован.
  - Остается 2 незаблокированных запроса, отмен — 0.
  - Коэффициент отмены = (0 / 2) = 0.00

- 2013-10-03:
  - Всего 3 запроса, 1 отменён.
  - Запрос с Id=8 исключается (заблокированный клиент).
  - Остается 2 незаблокированных запроса, 1 отменён.
  - Коэффициент отмены = (1 / 2) = 0.50
